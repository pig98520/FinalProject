{
    "collab_server" : "",
    "contents" : "---\ntitle: \"\"\nauthor: \"B0344218葉建夆 B0344117沈庭安\"\ndate: \"2017年6月9日\"\noutput: html_document\n---\n\n=================================================================  \n\n一、資料介紹、來源及格式\n\n1.桃園國際機場即時航班(6/5-6/7):\n>桃園國際機場每天更新，當天及其前後兩天之航班狀況，當中包含往來地點、時間等資料。  \n>X0605_0607\n>CSV檔案\n>http://data.gov.tw/node/26194\n\n2.中華民國國民出國目的地人數統計(2016):  \n>中華民國國民歷年來到各國家的人數統計  \n>aborad(taiwan2016)  \n>excel檔案  \n>http://admin.taiwan.net.tw/statistics/year.aspx?no=134  \n\n3.日本國內航班資料:  \n>日本境內航班近年來變化的狀況  \n>除上述兩檔案以外excel檔案  \n>excel檔案  \n>http://www.data.go.jp  \n=================================================================\n\n二、分析議題  \n1.桃園機場各航空公司之航班的延誤比例  \n2.台灣到各國旅遊的分布圖 \n3.台灣到日本近年來旅遊人數的變化\n4.日本仙台地區近15年(2000-2015)來國內航班的變化  \n5.日本福島地區近15年(2000-2015)來國內航班的變化  \n  \n\n=================================================================\n\n三、假設  \n1.  \n2.  \n3.  \n\n=================================================================\n\n\n四、分析過程\n\n##載入需要用到的packages\n```{r}\nlibrary(readr)\nlibrary(readxl)\nlibrary(magrittr)\nlibrary(ggmap)\nlibrary(ggplot2)\n```\n\n##載入資料\n```{r }\nX0605_0607 <- read_csv(\"C:/Users/pig98/Desktop/FinalProject/0605_0607.csv\", \n                       col_names = FALSE)\n#桃園機場的CSV檔單獨讀入\n\ntemp = list.files(pattern=\"*.xls\")\nfor (i in 1:length(temp)) \n  assign(temp[i], read_excel(temp[i]))\n#其餘excel資料用迴圈讀入\n```\n\n##資料清洗\n```{r }\n#去除不需要的欄位以及中文名稱\nX0605_0607<-X0605_0607[,c(-4,-11,-13,-14,-17,-18)] \n#新增欄位名稱\ncolnames(X0605_0607)=c(\"terminals\",\"species\",\"airline_id\",\"flight\",\"gate\",\n                       \"scheduled_date\",\"scheduled_time\",\"expected_date\",\"expected_time\",\n                       \"destination\",\"model\",\"other destination\",\"baggage claim\",\"counter\")\n#依照航空公司代碼簡單排序資料\nX0605_0607<-X0605_0607[order(X0605_0607$airline_id),]\n\nknitr::kable(X0605_0607)\n```\n\n\n##資料分析1:哪些航空公司的班機最容易誤點/最準時\n```{r }\n#新增一個欄位判斷班機是否delay\nfor(n in 1:nrow(X0605_0607) )\n{\n  if(X0605_0607[n,6]==X0605_0607[n,8]){\n    if(X0605_0607[n,7]<X0605_0607[n,9]){\n      X0605_0607$delay[n]=\"T\"\n    }else\n      X0605_0607$delay[n]=\"F\"\n  }\n  else if(X0605_0607[n,6]<X0605_0607[n,8])\n    X0605_0607$delay[n]=\"T\"\n  else if(X0605_0607[n,6]>X0605_0607[n,8])\n    X0605_0607$delay[n]=\"F\"\n}\nknitr::kable(X0605_0607)\n\n#將資料分成出境跟入境兩個子集\narrive<-subset(X0605_0607,species==\"A\");\ndepart<-subset(X0605_0607,species==\"D\");\n\n#用table統計出各航空公司的有/無delay次數,並轉為dataframe\narrive_delay<-table(airline=arrive$airline_id,delay=arrive$delay)%>%as.data.frame.matrix()\ndepart_delay<-table(airline=depart$airline_id,delay=depart$delay)%>%as.data.frame.matrix()\n\n#整理出各航空公司的航班數\nflight_num<-table(airline=X0605_0607$airline_id,species=X0605_0607$species)%>%as.data.frame.matrix()\nflight_num<-flight_num[order(flight_num$A+flight_num$D,decreasing = T),]\n#檢視各航空公司的航班數\nknitr::kable(flight_num)\n\n#計算出各航空公司的delay比例\narrive_delay$ratio<-arrive_delay$T/(arrive_delay$T+arrive_delay$F)\ndepart_delay$ratio<-depart_delay$T/(depart_delay$T+depart_delay$F)\nknitr::kable(arrive_delay)\nknitr::kable(depart_delay)\n\n#入境最不準時的六大航空公司:捷星太平洋、遠東航空、四川、全亞洲、德威、濟州\nhead(arrive_delay[order(arrive_delay$ratio,decreasing = T),])\n#入境最準時的六大航空公司:景成、酷航、聯合、歐洲、酷島、易斯達\ntail(arrive_delay[order(arrive_delay$ratio,decreasing = T),])\n#出境最不準時的六大航空公司:義大利、捷星太平洋、吉祥、濟州、遠東、捷星日本\nhead(depart_delay[order(depart_delay$ratio,decreasing = T),])\n#出境最準時的六大航空公司:加拿大、法國、馬亞洲、阿聯酋、景成、德威\ntail(depart_delay[order(depart_delay$ratio,decreasing = T),])\n```\n\n##資料分析2:台灣到各國旅遊的分布圖\n```{r }\n#將2016年到各國旅遊的人數取出來單獨做一個資料表\ntravel<-cbind(`aborad(taiwan2016).xls`[-1,2],`aborad(taiwan2016).xls`[-1,17])\n\n#欄位命名並刪除不需要的資料\ncolnames(travel)=c(\"region\",\"num\")\ntravel<-travel[-c(15,16,19,20,28,29,33,34,36,37,38,39,40),]\n\n#將名稱全部轉為只剩英文，以方便轉換經緯度，並將不適合地圖的名稱做更正\ntravel$region<-gsub(\"[^A-Za-z]\",replacement=\" \",travel$region)\ntravel[4,1]<-\"Korea\"\ntravel[2,1]<-\"China\"\n\n#將人數轉為數值\ntravel$num<-as.numeric(travel$num)\n\n#建立一個經緯度表格\ntravel_geo<-geocode(travel$region)\n\n#用borders建立一個世界地圖的環境\nworld_map<-borders(\"world\", colour=\"gray50\", fill=\"gray\", size=1)\n\nknitr::kable(travel)\nknitr::kable(travel_geo)\n\n#利用疊圖的方式，將world_map，和geom_point()利用剛剛的經緯度產生的點疊再一起，並利用顏色來區分個數\ntravel_world=ggplot()+\n            world_map+\n            geom_point(aes(x=travel_geo$lon, y=travel_geo$lat,color=travel$num))+ \n            scale_color_continuous(low = \"blue\",high = \"red\")+ \n            guides(size=FALSE)\n\n\ntravel_world\n```\n##資料分析3:台灣到日本旅遊的人數變化\n\n```{r }\ntojapan<-data.frame(year=c(2002:2016),num=0)\nfor(i in 1:15){\n  tojapan[i,2]=`aborad(taiwan2016).xls`[4,i+2] \n}\n#建立一個資料表，將到日本旅遊的人數資料逐年讀入\n\ntojapan$num<-as.numeric(tojapan$num)\n#將人數資料轉為數值\n\nknitr::kable(tojapan)\n\nplot(tojapan$year, tojapan$num/10000, type=\"l\",xlim=c(2002,2016),col=\"blue\",main=\"台灣到日本旅遊人數變化\",xlab=\"年份\",ylab=\"人數(萬人)\")\n#以年分為X軸、人數為Y軸做折線圖分析\n \n```\n\n##資料分析4:到仙台旅遊的人數變化\n```{r }\nsendai_passengers<-data.frame(year=c(2000,2001,2002,2003,\n                                    2004,2005,2006,2007,\n                                    2008,2009,2010,2011,\n                                    2012,2013,2014,2015),\n                             num=c(as.numeric(`2000國內定期航空(旅客流動).xls`[nrow(`2000國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2001國內定期航空(旅客流動).xls`[nrow(`2001國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2002國內定期航空(旅客流動).xls`[nrow(`2002國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2003國內定期航空(旅客流動).xls`[nrow(`2003國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2004國內定期航空(旅客流動).xls`[nrow(`2004國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2005國內定期航空(旅客流動).xls`[nrow(`2005國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2006國內定期航空(旅客流動).xls`[nrow(`2006國內定期航空(旅客流動).xls`),20]),\n                                   as.numeric(`2007國內定期航空(旅客流動).xls`[nrow(`2007國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2008國內定期航空(旅客流動).xls`[nrow(`2008國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2009國內定期航空(旅客流動).xls`[nrow(`2009國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2010國內定期航空(旅客流動).xls`[nrow(`2010國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2011國內定期航空(旅客流動).xls`[nrow(`2011國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2012國內定期航空(旅客流動).xls`[nrow(`2012國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2013國內定期航空(旅客流動).xls`[nrow(`2013國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2014國內定期航空(旅客流動).xls`[nrow(`2014國內定期航空(旅客流動).xls`),22]),\n                                   as.numeric(`2015國內定期航空(旅客流動).xls`[nrow(`2015國內定期航空(旅客流動).xls`),22])))\n\nknitr::kable(sendai_passengers)\n\n#建立一個只有年分、人數的資料表\n\nplot(sendai_passengers$year, sendai_passengers$num/10000, type = \"l\",xlim=c(2000,2015),col=\"blue\",main=\"到仙台旅遊人數變化\",xlab=\"年份\",ylab=\"人數(萬人)\")\n#以年分為X軸、人數為Y軸做折線圖分析\n```\n\n##資料分析5:到福島旅遊的人數變化\n```{r }\nfukushima_passengers<-data.frame(year=c(2000,2001,2002,2003,\n                                    2004,2005,2006,2007,\n                                    2008,2009,2010,2011,\n                                    2012,2013,2014,2015),\nnum=c(as.numeric(`2000國內定期航空(旅客流動).xls`[nrow(`2000國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2001國內定期航空(旅客流動).xls`[nrow(`2001國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2002國內定期航空(旅客流動).xls`[nrow(`2002國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2003國內定期航空(旅客流動).xls`[nrow(`2003國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2004國內定期航空(旅客流動).xls`[nrow(`2004國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2005國內定期航空(旅客流動).xls`[nrow(`2005國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2006國內定期航空(旅客流動).xls`[nrow(`2006國內定期航空(旅客流動).xls`),25]),\n                                   as.numeric(`2007國內定期航空(旅客流動).xls`[nrow(`2007國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2008國內定期航空(旅客流動).xls`[nrow(`2008國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2009國內定期航空(旅客流動).xls`[nrow(`2009國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2010國內定期航空(旅客流動).xls`[nrow(`2010國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2011國內定期航空(旅客流動).xls`[nrow(`2011國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2012國內定期航空(旅客流動).xls`[nrow(`2012國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2013國內定期航空(旅客流動).xls`[nrow(`2013國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2014國內定期航空(旅客流動).xls`[nrow(`2014國內定期航空(旅客流動).xls`),27]),\n                                   as.numeric(`2015國內定期航空(旅客流動).xls`[nrow(`2015國內定期航空(旅客流動).xls`),27])))\n\nknitr::kable(fukushima_passengers)\n#建立一個只有年分、人數的資料表\n\nplot(fukushima_passengers$year, fukushima_passengers$num/10000, type = \"l\",xlim=c(2000,2015),col=\"blue\",main=\"到福島旅遊人數變化\",xlab=\"年份\",ylab=\"人數(萬人)\")\n#以年分為X軸、人數為Y軸做折線圖分析\n```\n\n\n=================================================================\n\n五、分析結果  \n1.桃園機場各航空公司的誤點狀況:  \n>\n2.台灣到各國旅遊的分布圖:  \n>\n3.台灣到日本旅遊的人數變化:  \n>\n4.日本仙台、福島地區國內近15年來旅遊人數的變化:  \n>\n\n\n=================================================================\n\n六、分析結果可能解決的問題  \n\n\n=================================================================\n\n七、組員名單及分工  \n\nB0344218葉建夆  \n>資料蒐集(桃園機場)  \n>資料分析1、2、3  \n>投影片內容大綱  \n\nB0344117沈庭安  \n>資料蒐集(台灣人旅遊目的地、日本境內航班)\n>資料分析3、4、5  \n>投影片校正  \n\n=================================================================",
    "created" : 1497097613685.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1440115936",
    "id" : "BDE6C916",
    "lastKnownWriteTime" : 1497193220,
    "last_content_update" : 1497252440762,
    "path" : "C:/Users/pig98/Desktop/FinalProject/README.Rmd",
    "project_path" : "README.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}